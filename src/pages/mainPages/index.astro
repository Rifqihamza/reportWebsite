---
import MainPage from "./index";

---


<section>
  <div id="container" class="max-w-6xl mx-auto p-6 md:px-10 md:py-4">
    <MainPage client:load />
  </div>
</section>

<script>
  // Use a self-executing function to avoid global scope pollution
  (function () {
    document.addEventListener("DOMContentLoaded", function () {
      const form = document.getElementById("report-form");
      const fileInput = document.getElementById("foto");
      const fileNameDisplay = document.getElementById("file-name-display");

      // File input change handler
      if (fileInput && fileNameDisplay) {
        fileInput.addEventListener("change", function () {
          const inputElement = this as HTMLInputElement;
          if (inputElement.files && inputElement.files[0]) {
            const files = (this as HTMLInputElement).files;
            const fileName =
              files && files[0] ? files[0].name : "Klik untuk upload foto";
            fileNameDisplay.textContent = fileName;
          } else {
            fileNameDisplay.textContent = "Klik untuk upload foto";
          }
        });
      }

      // Form submission
      if (form) {
        form.addEventListener("submit", function (e) {
          e.preventDefault();

          // Collect form data
          const formData = new FormData(form as HTMLFormElement);

          // Simple form validation
          const laporan = formData.get("laporan");
          const lokasi = formData.get("lokasi");
          const pic = formData.get("pic");
          const kategori = formData.get("kategori");
          const followup = formData.get("followup");

          if (!laporan || !lokasi) {
            alert("Harap isi semua kolom yang diperlukan");
            return;
          }

          // Log form data (for demonstration)
          console.log("Form data:", Object.fromEntries(formData));

          // Here you would send the data to your server
          // For now, just show a success message
          alert("Laporan berhasil dikirim!");
          (form as HTMLFormElement).reset();

          // Reset dropdown labels
          document
            .querySelectorAll(".dropdown-label")
            .forEach(function (label) {
              const dropdownContainer = label.closest(".dropdown-container");
              const dropdownId = dropdownContainer
                ? dropdownContainer.getAttribute("data-dropdown-id")
                : null;
              const defaultLabels = {
                pic: "Pilih PIC",
                kategori: "Pilih Kategori",
                followup: "Pilih Follow Up",
              };

              if (
                dropdownId &&
                defaultLabels[dropdownId as keyof typeof defaultLabels]
              ) {
                label.textContent =
                  defaultLabels[dropdownId as keyof typeof defaultLabels];
              }
            });

          // Reset file input display
          if (fileNameDisplay) {
            fileNameDisplay.textContent = "Klik untuk upload foto";
          }
        });
      }
    });
  })();

  // Used for dropdown
  (function () {
    document.addEventListener("DOMContentLoaded", function () {
      const dropdowns = document.querySelectorAll(".dropdown-container");

      dropdowns.forEach(function (dropdown) {
        const trigger = dropdown.querySelector(".dropdown-trigger");
        const menu = dropdown.querySelector(".dropdown-menu");
        const items = dropdown.querySelectorAll(".dropdown-item");
        const input = dropdown.querySelector('input[type="hidden"]');
        const labelEl = dropdown.querySelector(".dropdown-label");

        if (!trigger || !menu) return;

        trigger.addEventListener("click", function (e) {
          e.stopPropagation();

          const isExpanded = trigger.getAttribute("aria-expanded") === "true";

          // Close all other dropdowns
          dropdowns.forEach(function (otherDropdown) {
            if (otherDropdown !== dropdown) {
              const otherTrigger =
                otherDropdown.querySelector(".dropdown-trigger");
              const otherMenu = otherDropdown.querySelector(".dropdown-menu");
              if (otherTrigger)
                otherTrigger.setAttribute("aria-expanded", "false");
              if (otherMenu) otherMenu.classList.add("hidden");
            }
          });

          // Toggle current dropdown
          trigger.setAttribute("aria-expanded", String(!isExpanded));
          menu.classList.toggle("hidden");
        });

        items.forEach(function (item) {
          item.addEventListener("click", function (e) {
            e.stopPropagation();
            const value = item.getAttribute("data-value");

            if (input) (input as HTMLInputElement).value = value || "";
            if (labelEl) labelEl.textContent = value;

            trigger.setAttribute("aria-expanded", "false");
            menu.classList.add("hidden");
          });
        });
      });

      document.addEventListener("click", function () {
        dropdowns.forEach(function (dropdown) {
          const trigger = dropdown.querySelector(".dropdown-trigger");
          const menu = dropdown.querySelector(".dropdown-menu");

          if (trigger) trigger.setAttribute("aria-expanded", "false");
          if (menu) menu.classList.add("hidden");
        });
      });
    });
  })()
</script>


<style is:global>
  .tab-button {
    cursor: pointer;
    background-color: #f9f9f9;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 1rem 2rem;
    border-radius: 1rem 1rem 0 0;
    border-bottom: 2px solid transparent;
    transition: all 0.2s ease-in-out;
    font-weight: 600;
    font-size: 0.875rem;
    color: #aeaeae;
  }

  .tab-button.active {
    background-color: #fff;
    z-index: 10;
    box-shadow: 0 0px 1px rgba(0, 0, 0, 0.202);
    position: relative;
    color: #000; /* blue-800 */
  }

  .mobile-tab {
    color: #6b7280;
    position: relative;
  }

  .mobile-tab.active {
    color: #1e40af; /* blue-800 */
  }

  .mobile-tab.active::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 25%;
    width: 50%;
    height: 2px;
    background-color: #1e40af; /* blue-800 */
  }

  .tab-content {
    display: none;
  }

  .tab-content.active {
    display: block;
  }

  @media (min-width: 768px) {
    .fixed.bottom-0.md\:hidden {
      display: none;
    }
  }
</style>
